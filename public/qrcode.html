<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
<img id="qrcode" src="data:image/png;base64,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" alt="">
<div id="status-div"></div>
<script>
  const status = {
    0: '未授权',
    1: '已授权',
    2: '超时'
  }
  const qrcode = document.getElementById('qrcode')
  const statusDiv = document.getElementById('status-div')
  let userId = null
  statusDiv.innerText = status[0]
  fetch('/qrcode').then(res => res.json()).then(res => {
    // qrcode.src = res.code //获取二维码
    qrcode.src = 'data:image/png;base64,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'//获取二维码
    userId = res.userId //获取用户id
    let timer = setInterval(() => {
      //轮询调用检查接口
      fetch(`/check/${userId}`).then(res => res.json()).then(res => {
        statusDiv.innerText = status[res.status]
        //如果返回的状态是 超时 或者是已授权 就停止轮训
        if (res.status != 0) {
          clearInterval(timer)
        }
      })
    }, 1000)
  })

</script>
</body>

</html>
